<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Síň megalovců 3D – Galerie legend</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #000;
      color: #fff;
    }
    #overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, rgba(80,80,120,0.6), rgba(0,0,0,0.95));
      color: #fff;
      z-index: 10;
      cursor: pointer;
      flex-direction: column;
      text-align: center;
    }
    #overlay h1 {
      letter-spacing: 0.15em;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 0.4em;
    }
    #overlay p {
      opacity: 0.85;
      max-width: 480px;
    }
    #info {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 5;
      background: rgba(0,0,0,0.55);
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 13px;
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.08);
    }
  </style>
</head>
<body>
<div id="overlay">
  <h1>SÍŇ MEGALOVCŮ</h1>
  <p>Klikni pro vstup do galerie legend. Ovládání: WASD = pomalá chůze, myš = rozhlížení, Esc = kurzor.</p>
</div>
<div id="info">
  Prohlídka: WASD = chůze, myš = rozhlížení
</div>

<script type="module">
  import * as THREE from './three.module.js';
  import { PointerLockControls } from './PointerLockControls.js';

  // ===== SCÉNA =====
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x050509);
  scene.fog = new THREE.FogExp2(0x050509, 0.035);

  const camera = new THREE.PerspectiveCamera(
    70,
    window.innerWidth / window.innerHeight,
    0.1,
    200
  );

  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;
  document.body.appendChild(renderer.domElement);

  // ===== SVĚTLA =====
  const hemiLight = new THREE.HemisphereLight(0x8899ff, 0x202020, 0.6);
  scene.add(hemiLight);

  const mainSpot = new THREE.SpotLight(0xffffff, 1.2, 80, Math.PI / 4, 0.4, 1);
  mainSpot.position.set(0, 12, 0);
  mainSpot.castShadow = true;
  scene.add(mainSpot);

  // jemné barevné akcenty
  const accentLeft = new THREE.PointLight(0x4466ff, 0.7, 30);
  accentLeft.position.set(-8, 3, -8);
  scene.add(accentLeft);

  const accentRight = new THREE.PointLight(0xaa66ff, 0.7, 30);
  accentRight.position.set(8, 3, -8);
  scene.add(accentRight);

  // ===== ROZMĚRY MÍSTNOSTI =====
  const roomWidth = 22;
  const roomDepth = 32;
  const roomHeight = 8;

  // ===== MATERIÁLY =====
  const wallMaterial = new THREE.MeshStandardMaterial({
    color: 0x15151c,
    metalness: 0.4,
    roughness: 0.7
  });

  const floorMaterial = new THREE.MeshStandardMaterial({
    color: 0x08080b,
    metalness: 0.7,
    roughness: 0.25
  });

  const trimEmissive = new THREE.MeshStandardMaterial({
    color: 0x111122,
    emissive: new THREE.Color(0x3355ff),
    emissiveIntensity: 1.8,
    metalness: 0.8,
    roughness: 0.2
  });

  const trimEmissivePurple = new THREE.MeshStandardMaterial({
    color: 0x111122,
    emissive: new THREE.Color(0xaa55ff),
    emissiveIntensity: 1.6,
    metalness: 0.8,
    roughness: 0.2
  });

  // ===== PODLAHA A STROP =====
  const floorGeo = new THREE.PlaneGeometry(roomWidth, roomDepth);
  const floor = new THREE.Mesh(floorGeo, floorMaterial);
  floor.rotation.x = -Math.PI / 2;
  floor.receiveShadow = true;
  scene.add(floor);

  const ceilingGeo = new THREE.PlaneGeometry(roomWidth, roomDepth);
  const ceiling = new THREE.Mesh(ceilingGeo, wallMaterial);
  ceiling.rotation.x = Math.PI / 2;
  ceiling.position.y = roomHeight;
  ceiling.receiveShadow = true;
  scene.add(ceiling);

  // ===== STĚNY =====
  const colliders = [];

  function createWall(width, height, depth, x, y, z, rotY = 0) {
    const geo = new THREE.BoxGeometry(width, height, depth);
    const mesh = new THREE.Mesh(geo, wallMaterial);
    mesh.position.set(x, y, z);
    mesh.rotation.y = rotY;
    mesh.castShadow = true;
    mesh.receiveShadow = true;
    scene.add(mesh);
    colliders.push(mesh);
    return mesh;
  }

  // zadní, přední, levá, pravá
  createWall(roomWidth, roomHeight, 0.6, 0, roomHeight / 2, -roomDepth / 2);
  createWall(roomWidth, roomHeight, 0.6, 0, roomHeight / 2, roomDepth / 2);
  createWall(roomDepth, roomHeight, 0.6, -roomWidth / 2, roomHeight / 2, 0, Math.PI / 2);
  createWall(roomDepth, roomHeight, 0.6, roomWidth / 2, roomHeight / 2, 0, Math.PI / 2);

  // ===== SVĚTELNÉ LIŠTY (DEKOR) =====
  function createTrim(x, y, z, w, h, d, material) {
    const geo = new THREE.BoxGeometry(w, h, d);
    const mesh = new THREE.Mesh(geo, material);
    mesh.position.set(x, y, z);
    mesh.castShadow = false;
    mesh.receiveShadow = false;
    scene.add(mesh);
    return mesh;
  }

  // podél podlahy
  createTrim(0, 0.05, -roomDepth / 2 + 0.3, roomWidth, 0.1, 0.2, trimEmissive);
  createTrim(0, 0.05, roomDepth / 2 - 0.3, roomWidth, 0.1, 0.2, trimEmissivePurple);
  createTrim(-roomWidth / 2 + 0.3, 0.05, 0, roomDepth, 0.1, 0.2, trimEmissive);
  createTrim(roomWidth / 2 - 0.3, 0.05, 0, roomDepth, 0.1, 0.2, trimEmissivePurple);

  // ===== „DATA“ – MOCK ŽEBŘÍČKY =====
  const leaderboard = [
    { name: 'MegaHunterCZ', score: 98765 },
    { name: 'ShadowWolf', score: 87654 },
    { name: 'PixelSlayer', score: 76543 },
    { name: 'NoScopeNinja', score: 65432 },
    { name: 'LuckyShot', score: 54321 }
  ];

  const hallOfFame = [
    'Hall of Fame',
    '-----------------',
    'MegaHunterCZ – 12x #1',
    'ShadowWolf – 9x top 3',
    'PixelSlayer – 7x MVP'
  ];

  const streaks = [
    'Nejdelší série',
    '-----------------',
    'NoScopeNinja – 47',
    'LuckyShot – 39',
    'ShadowWolf – 34'
  ];

  // ===== TEXTOVÉ PANELY =====
  const textCanvasCache = {};

  function createTextTexture(lines, width = 512, height = 512) {
    const key = lines.join('\n');
    if (textCanvasCache[key]) return textCanvasCache[key];

    const canvas = document.createElement('canvas');
    canvas.width = width;
    canvas.height = height;
    const ctx = canvas.getContext('2d');

    // pozadí panelu
    const gradient = ctx.createLinearGradient(0, 0, 0, height);
    gradient.addColorStop(0, '#111320');
    gradient.addColorStop(1, '#05060b');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, width, height);

    // rámeček
    ctx.strokeStyle = 'rgba(180,180,255,0.5)';
    ctx.lineWidth = 4;
    ctx.strokeRect(16, 16, width - 32, height - 32);

    ctx.fillStyle = '#ffffff';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';

    let y = 40;
    for (let i = 0; i < lines.length; i++) {
      const line = lines[i];
      ctx.font = i === 0 ? 'bold 40px "Segoe UI", sans-serif' : '24px "Segoe UI", sans-serif';
      ctx.fillText(line, width / 2, y);
      y += i === 0 ? 52 : 34;
    }

    const texture = new THREE.CanvasTexture(canvas);
    texture.anisotropy = renderer.capabilities.getMaxAnisotropy();
    texture.needsUpdate = true;
    textCanvasCache[key] = texture;
    return texture;
  }

  function createPanel(lines, widthWorld, heightWorld, x, y, z, rotY) {
    const geo = new THREE.PlaneGeometry(widthWorld, heightWorld);
    const tex = createTextTexture(lines);
    const mat = new THREE.MeshStandardMaterial({
      map: tex,
      metalness: 0.4,
      roughness: 0.6,
      emissive: new THREE.Color(0x111122),
      emissiveIntensity: 0.4
    });
    const mesh = new THREE.Mesh(geo, mat);
    mesh.position.set(x, y, z);
    mesh.rotation.y = rotY;
    mesh.castShadow = true;
    mesh.receiveShadow = true;
    scene.add(mesh);
    return mesh;
  }

  // hlavní leaderboard panel – zadní stěna
  const leaderboardLines = [
    'Síň megalovců',
    '-----------------',
    ...leaderboard.map((d, i) => `${i + 1}. ${d.name} — ${d.score}`)
  ];
  createPanel(
    leaderboardLines,
    9,
    5,
    0,
    4.2,
    -roomDepth / 2 + 0.31,
    0
  );

  // Hall of Fame – levá stěna
  createPanel(
    hallOfFame,
    6,
    4,
    -roomWidth / 2 + 0.31,
    4,
    -6,
    Math.PI / 2
  );

  // Nejdelší série – pravá stěna
  createPanel(
    streaks,
    6,
    4,
    roomWidth / 2 - 0.31,
    4,
    -2,
    -Math.PI / 2
  );

  // ===== TROFEJE / PODSTAVCE UPROSTŘED =====
  const pedestalMat = new THREE.MeshStandardMaterial({
    color: 0x181820,
    metalness: 0.6,
    roughness: 0.35
  });

  function createPedestal(x, z, height = 1.2) {
    const geo = new THREE.CylinderGeometry(0.7, 0.9, height, 24);
    const mesh = new THREE.Mesh(geo, pedestalMat);
    mesh.position.set(x, height / 2, z);
    mesh.castShadow = true;
    mesh.receiveShadow = true;
    scene.add(mesh);
    return mesh;
  }

  function createTrophy(x, z, color) {
    const geo = new THREE.SphereGeometry(0.45, 32, 32);
    const mat = new THREE.MeshStandardMaterial({
      color: 0xffffff,
      emissive: new THREE.Color(color),
      emissiveIntensity: 1.8,
      metalness: 0.9,
      roughness: 0.15
    });
    const mesh = new THREE.Mesh(geo, mat);
    mesh.position.set(x, 2.0, z);
    mesh.castShadow = true;
    scene.add(mesh);
    return mesh;
  }

  const ped1 = createPedestal(-3, 0);
  const ped2 = createPedestal(0, -3);
  const ped3 = createPedestal(3, 0);

  const trophy1 = createTrophy(-3, 0, 0xffd700); // zlatá
  const trophy2 = createTrophy(0, -3, 0x44ddff);
  const trophy3 = createTrophy(3, 0, 0xaa66ff);

  // centrální „monument“ – světelný sloup
  const monumentGeo = new THREE.CylinderGeometry(0.6, 0.6, 5.5, 32);
  const monumentMat = new THREE.MeshStandardMaterial({
    color: 0x111122,
    emissive: new THREE.Color(0x4466ff),
    emissiveIntensity: 1.4,
    metalness: 0.9,
    roughness: 0.1,
    transparent: true,
    opacity: 0.85
  });
  const monument = new THREE.Mesh(monumentGeo, monumentMat);
  monument.position.set(0, 2.8, 0);
  monument.castShadow = false;
  monument.receiveShadow = false;
  scene.add(monument);

  const monumentLight = new THREE.PointLight(0x6688ff, 1.4, 18);
  monumentLight.position.set(0, 4.5, 0);
  scene.add(monumentLight);

  // ===== OVLÁDÁNÍ – TOUR MÓD =====
  const controls = new PointerLockControls(camera, document.body);
  const overlay = document.getElementById('overlay');

  overlay.addEventListener('click', () => {
    controls.lock();
  });

  controls.addEventListener('lock', () => {
    overlay.style.display = 'none';
  });

  controls.addEventListener('unlock', () => {
    overlay.style.display = 'flex';
  });

  scene.add(controls.getObject());

  // startovní pozice – u vstupu
  controls.getObject().position.set(0, 1.8, roomDepth / 2 - 4);

  const velocity = new THREE.Vector3();
  const keyStates = {};
  const moveSpeed = 4.0; // pomalá chůze

  document.addEventListener('keydown', (e) => {
    keyStates[e.code] = true;
  });
  document.addEventListener('keyup', (e) => {
    keyStates[e.code] = false;
  });

  function getForwardVector() {
    const forward = new THREE.Vector3();
    camera.getWorldDirection(forward);
    forward.y = 0;
    forward.normalize();
    return forward;
  }

  function getSideVector() {
    const side = new THREE.Vector3();
    camera.getWorldDirection(side);
    side.y = 0;
    side.normalize();
    side.cross(camera.up);
    return side;
  }

  function handleMovement(delta) {
    if (!controls.isLocked) return;

    // jemné zpomalování – chůze, ne klouzání
    velocity.x *= 0.85;
    velocity.z *= 0.85;

    const forward = getForwardVector();
    const side = getSideVector();

    if (keyStates['KeyW']) velocity.addScaledVector(forward, moveSpeed * delta);
    if (keyStates['KeyS']) velocity.addScaledVector(forward, -moveSpeed * delta);
    if (keyStates['KeyA']) velocity.addScaledVector(side, -moveSpeed * delta);
    if (keyStates['KeyD']) velocity.addScaledVector(side, moveSpeed * delta);

    const oldPos = controls.getObject().position.clone();
    const newPos = oldPos.clone().addScaledVector(velocity, 1);

    const halfWidth = roomWidth / 2 - 0.8;
    const halfDepth = roomDepth / 2 - 0.8;

    if (newPos.x < -halfWidth) newPos.x = -halfWidth;
    if (newPos.x > halfWidth) newPos.x = halfWidth;
    if (newPos.z < -halfDepth) newPos.z = -halfDepth;
    if (newPos.z > halfDepth) newPos.z = halfDepth;

    newPos.y = 1.8; // žádná gravitace, fixní výška

    controls.getObject().position.copy(newPos);
  }

  // ===== ANIMACE =====
  const clock = new THREE.Clock();

  function animate() {
    requestAnimationFrame(animate);
    const delta = clock.getDelta();

    handleMovement(delta);

    // jemná rotace trofejí a monumentu
    const t = clock.getElapsedTime();
    trophy1.rotation.y = t * 0.4;
    trophy2.rotation.y = -t * 0.35;
    trophy3.rotation.y = t * 0.5;
    monument.rotation.y = t * 0.12;

    renderer.render(scene, camera);
  }

  animate();

  // ===== RESIZE =====
  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>
</body>
</html>